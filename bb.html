<!doctype html>
<html>
<head>
	<title>Backbone Test</title>
	<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/css/bootstrap-combined.min.css" rel="stylesheet">
	<link href="http://fonts.googleapis.com/css?family=Fjalla+One" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="l5r.css">
	<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.3/underscore-min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.9/backbone-min.js"></script>
	<script src="saveAs.js"></script>
	<script>
		$(document).ready(function () {

			_.templateSettings = {
				interpolate: /\{\{(.+?)\}\}/g
			};

			var Information = Backbone.Model.extend({
				defaults: {
					name: '',
					rank: '',
					clan: '',
					exp: '',
					school: '',
					insight: ''
				}
			});

			information = new Information();

			var Info = Backbone.View.extend({
				el: $('#info'),

				model: information,

				events: {
					"change input" 	   	 : "setInfo",
				},

			    setInfo: function(e) {
			    	this.model.set(e.target.id, e.target.value);
			    },

			    initialize: function() {
			    	this.render();
			    },

			    render: function () {
					var template = _.template(this.el.innerHTML);
					this.el.innerHTML = template(this.model.attributes);
			    }
			});

			sheet = new Info();

			//var characterSheet = new Backbone.Collection([information, {bob:'test'}]);

			/*var characterSheet = Backbone.Collection.extend({

			});*/

			var IO = Backbone.View.extend({

				el: "body",

				model: information,

				events: {
					"click button.save": "saveData"
				},

			    saveData: function() {
			    	console.log(this.model.toJSON());
					var blob = new Blob([JSON.stringify(this.model.toJSON())], {type: 'text/plain;charset=utf-8'});
					saveAs(blob, (this.model.get('name') || "character") + ".l5r");
			    }

			});

			io = new IO();
		});
	</script>
</head>

<body>
<div id="page1" class="container-narrow">
	<div class="jumbotron">
		<div class="masthead">
			<img src="images/l5r-logo.png" alt="L5R Logo" id="logo" class="pull-right" />
			<h1>L5R Character Sheet</h1>
		</div>
		<hr>
		<div class="row">
			<div class="span12">
				<button class="btn">Load</button>
				<button class="btn btn-primary save">Save</button>
			</div>
		</div>
		<hr>
		<div id="info">
			<h2>Information</h2>
			<div class="row-fluid">
				<div class="span6">
					<label for="name">Name</label><input id="name" type="text" value="{{name}}" />
				</div>
				<div class="span6">
					<label for="rank">Rank</label><input id="rank" type="text" value="{{rank}}" />
				</div>
			</div>
			<div class="row-fluid">
				<div class="span6">
					<label for="clan">Clan</label><input id="clan" type="text" value="{{clan}}" />
				</div>
				<div class="span6">
					<label for="exp">Exp</label><input id="exp" type="text" value="{{exp}}" />
				</div>
			</div>
			<div class="row-fluid">
				<div class="span6">
					<label for="school">School</label><input id="school" type="text" value="{{school}}" />
				</div>
				<div class="span6">
					<label for="insight">Insight</label><input id="insight" type="text" value="{{insight}}" />
				</div>
			</div>
		</div>
		<hr>
	</div>
</div>
</body>
</html>